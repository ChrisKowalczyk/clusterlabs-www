<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
	<!--#include virtual="/header.html" -->
        <title>Cluster Labs - The Home of Pacemaker</title>
        <meta name="description" content="">
    </head>
    <body>
	<!--#include virtual="/banner.html" -->	

	<section id="main">
	  <!--#include virtual="/quickstart-common.html" -->	

	  <h1>SLES 11</h1>
	  <h2>Install</h2>
	  <p>
	    Pacemaker ships as part of the
	    SUSE <a href="https://www.suse.com/products/highavailability/">High
	    Availability Extension</a>.  To install, follow the
	    provided documentation.
	  </p>

	  <h2>Configure Cluster Membership and Messaging</h2>
	  <p>
	    The supported stack on SLES11 is based on
	    OpenAIS/Corosync, so thats what Pacemaker uses too.
	  </p>

	  <p>
	    First we create the Corosync configuration file on both machines
	    manually:
	  </p>
	  <p class="command">
[ALL] # cat <<EOF > /etc/corosync/corosync.conf
# Please read the corosync.conf.5 manual page
compatibility: whitetank
 
aisexec {
        # Run as root - this is necessary to be able to manage
        # resources with Pacemaker
        user:           root
        group:          root
}
 
service {
        # Load the Pacemaker Cluster Resource Manager
        ver:            0
        name:           pacemaker
        use_mgmtd:      yes
        use_logd:       yes
}
 
totem {
        # The only valid version is 2
        version:        2
 
        # How long before declaring a token lost (ms)
        token:          5000
 
        # How many token retransmits before forming a new configuration
        token_retransmits_before_loss_const: 10
 
        # How long to wait for join messages in the membership protocol (ms)
        join:           60
 
        # How long to wait for consensus to be achieved before starting
        # a new round of membership configuration (ms)
        consensus:      6000
 
        # Turn off the virtual synchrony filter
        vsftype:        none
 
        # Number of messages that may be sent by one processor on
        # receipt of the token
        max_messages:   20
 
        # Limit generated nodeids to 31-bits (positive signed integers)
        clear_node_high_bit: yes
 
        # Disable encryption
        secauth:        off
 
        # How many threads to use for encryption/decryption
        threads:        0
 
        # Optionally assign a fixed node id (integer)
        # nodeid:       1234
 
        interface {
                ringnumber: 0
                bindnetaddr: 192.168.1.0
                mcastaddr: 226.94.1.1
                mcastport: 5405
                ttl: 1
        }
}
 
logging {
        fileline: off
        to_stderr: no
        to_logfile: no
        to_syslog: yes
        syslog_facility: daemon
        debug: off
        timestamp: off
        logger_subsys {
                subsys: AMF
                debug: off
        }
}
 
amf {
        mode: disabled
}
EOF
          </p>

	  <h2>Start the Cluster</h2>
	  <p>
	    On each machine, run:
	  </p>
	  <p class="command">
[ALL] # rcopenais start
	  </p>

	  <h2>Set Cluster Options</h2>
	  <p>
	    With so many devices and possible topologies, it is nearly
	    impossible to include Fencing in a document like this.
	    For now we will disable it.
	  </p>
	  <p class="command">
[ONE] # crm configure property stonith-enabled=false
	  </p>
	  <p>
	    One of the most common ways to deploy Pacemaker is in a
	    2-node configuration.  However quorum as a concept makes
	    no sense in this scenario (because you only have it when
	    more than half the nodes are available), so we'll disable
	    it too.
	  </p>
	  <p class="command">
[ONE] # crm configure property no-quorum-policy=ignore
	  </p>
	  <p>
	    For demonstration purposes, we will force the cluster to
	    move services after a single failure:
	  </p>
	  <p class="command">
[ONE] # crm configure property migration-threshold=1
	  </p>

	  <h2>Add a Resource</h2>
	  <p>
	    Lets add a cluster service, we'll choose one doesn't
	    require any configuration and works everywhere to make
	    things easy.  Here's the command:
	  </p>
	  <p class="command">
[ONE] # crm configure primitive my_first_svc ocf:pacemaker:Dummy op monitor interval=120s
	  </p>
	  <p>
	    "<strong>my_first_svc</strong>" is the name the service
	    will be known as.
	  </p>
	  <p>
	    "<strong>ocf:pacemaker:Dummy</strong>" tells Pacemaker
	    which script to use
	    (<a href="https://github.com/ClusterLabs/pacemaker/blob/master/extra/resources/Dummy">Dummy</a>
	    - an agent that's useful as a template and for guides like
	    this one), which namespace it is in (pacemaker) and what
	    standard it conforms to
	    (<a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Pacemaker_Explained/s-resource-supported.html#_open_cluster_framework">OCF</a>).
	  </p>
	  <p>
	    "<strong>op monitor interval=120s</strong>" tells Pacemaker to
	    check the health of this service every 2 minutes by
	    calling the agent's <strong>monitor</strong> action.
	  </p>
	  <p>
	    You should now be able to see the service running using:
	  </p>
          <p class="command">
[ONE] # crm_mon -1
	  </p>

	  <h2>Simulate a Service Failure</h2>
	  <p>
	    We can simulate an error by telling the service stop
	    directly (without telling the cluster):
	  </p>
	  <p class="command">
[ONE] # crm_resource --resource my_first_svc --force-stop
	  </p>
	  <p>
	    If you now run <strong>crm_mon</strong> in interactive
	    mode (the default), you should see (within the monitor
	    interval - 2 minutes) the cluster notice
	    that <strong>my_first_svc</strong> failed and move it to
	    another node.
	  </p>
	  <h2>Next Steps</h2>
	  <p>
	    <ul>
	      <li>Configure <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/ch09.html">Fencing</a></li>
	      <li>Add more services - see <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/ch06.html">Clusters from Scratch</a> for examples of how to add IP address, Apache and DRBD to a cluster</li>
	      <li>Learn how to make services <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/_specifying_a_preferred_location.html">prefer a specific host</a></li>
	      <li>Learn how to make services <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/_ensuring_resources_run_on_the_same_host.html">run on the same host</a></li>
	      <li>Learn how to make services <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/_controlling_resource_start_stop_ordering.html">start and stop</a> in a specific order</li>
	      <li>Find out what else Pacemaker can do - see <a href="/doc/en-US/Pacemaker/1.1-crmsh/html/Pacemaker_Explained/index.html">Pacemaker Explained</a> for an comprehensive list of concepts and options</li>
	    </ul>
	  </p>

	</section>	

	<!--#include virtual="/footer.html" -->
    </body>
</html>
