# ClusterLabs.org website

## Installing Jekyll

ClusterLabs,org is partially generated by jekyll. Installing jekyll requires
the following dependencies:
* nodejs
* npm
* ruby
* ruby-devel
* rubygems
* rubygem-bundler
* rubygem-rdiscount

Once you have those, change to the +src+ directory and run `bundle install`.

## Using Jekyll

ClusterLabs.org's jekyll source is under the src directory. Jekyll will
generate static content to the html directory.
    
To generate content in a checkout for development and testing, change to the
+src+ directory and run `bundle exec jekyll build` (to merely generate content)
or `bundle exec jekyll serve` (to generate and test via a local server).
To generate content on the production site, run
`JEKYLL_ENV=production jekyll build` (which will enable such things as site
analytics and asset digests).
    
If +src/Gemfile+ changes, re-run `bundle install` afterward.

## Images, stylesheets and JavaScripts

We use the jekyll-assets plugin to manage "assets" such as images, stylesheets,
and JavaScript. One advantage is that digest hashes are automatically added to
the generated filenames when in production mode. This allows "cache busting"
when an asset changes, so we can use long cache times on the server end.
Another advantage is that sources are minified when in production mode.

How CSS is managed:
* +src/\_assets/css/main.scss+ is just a list of imports
* +src/\_assets/css/\_\*.scss+ contain the CSS to be imported by main.scss
* jekyll will generate html/assets/main.css (or main-_HASH_.css) as the
  combination of all imports
* web pages can reference the stylesheet via +{% css main %}+

JavaScript is managed similarly:
* +src/\_assets/js/main.js+ is just a list of requires
* +src/\_assets/js/\*.js+ contain the JavaScript to be required by main.js
* jekyll will copy these to html/assets
* jekyll will generate html/assets/main.js (or main-_HASH_.js) as the
  combination of all JavaScript
* web pages can reference the script via +{% js main %}+

Images are not managed this way yet, but will be.
